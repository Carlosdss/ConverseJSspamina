{"version":3,"sources":["../src/converse-dragresize.js"],"names":["root","factory","define","$","converse","tpl_dragresize","_","env","renderDragResizeHandles","_converse","view","flyout","el","querySelector","div","document","createElement","innerHTML","insertBefore","firstChild","plugins","add","optional_dependencies","overrides","registerGlobalEventHandlers","that","on","ev","resizing","allow_dragresize","preventDefault","chatbox","resizeChatBox","height","applyDragResistance","model","get","width","connection","connected","save","set","__super__","apply","arguments","ChatBox","initialize","result","bind","ChatBoxView","events","window","debounce","setDimensions","render","setWidth","$el","css","_show","initDragResize","$flyout","find","isUndefined","min_width","min_height","endsWith","Number","replace","prev_pageY","prev_pageX","adjustToViewport","setChatBoxHeight","setChatBoxWidth","children","style","viewport_width","Math","max","documentElement","clientWidth","innerWidth","viewport_height","clientHeight","innerHeight","undefined","onStartVerticalResize","pageY","onStartHorizontalResize","pageX","onStartDiagonalResize","direction","diff","indexOf","includes","HeadlinesBoxView","ControlBoxView","renderLoginPanel","renderContactsPanel","ChatRoomView","api","settings","update","value","default_value","resistance","abs"],"mappings":"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","file":"converse-dragresize.js","sourcesContent":["// Converse.js (A browser based XMPP chat client)\n// http://conversejs.org\n//\n// Copyright (c) 2012-2017, Jan-Carel Brand <jc@opkode.com>\n// Licensed under the Mozilla Public License (MPLv2)\n//\n/*global define, window */\n\n(function (root, factory) {\n    define([\"jquery.noconflict\",\n            \"converse-core\",\n            \"tpl!dragresize\",\n            \"converse-chatview\",\n            \"converse-muc\", // XXX: would like to remove this\n            \"converse-controlbox\"\n    ], factory);\n}(this, function ($, converse, tpl_dragresize) {\n    \"use strict\";\n    const { _ } = converse.env;\n\n    function renderDragResizeHandles (_converse, view) {\n        const flyout = view.el.querySelector('.box-flyout');\n        const div = document.createElement('div');\n        div.innerHTML = tpl_dragresize();\n        flyout.insertBefore(\n            div,\n            flyout.firstChild\n        );\n    }\n\n\n    converse.plugins.add('converse-dragresize', {\n        /* Optional dependencies are other plugins which might be\n         * overridden or relied upon, and therefore need to be loaded before\n         * this plugin. They are called \"optional\" because they might not be\n         * available, in which case any overrides applicable to them will be\n         * ignored.\n         *\n         * It's possible however to make optional dependencies non-optional.\n         * If the setting \"strict_plugin_dependencies\" is set to true,\n         * an error will be raised if the plugin is not found.\n         *\n         * NB: These plugins need to have already been loaded via require.js.\n         */\n        optional_dependencies: [\"converse-headline\"],\n\n        overrides: {\n            // Overrides mentioned here will be picked up by converse.js's\n            // plugin architecture they will replace existing methods on the\n            // relevant objects or classes.\n            //\n            // New functions which don't exist yet can also be added.\n\n            registerGlobalEventHandlers () {\n                const that = this;\n                \n                $(document).on('mousemove', function (ev) {\n                    if (!that.resizing || !that.allow_dragresize) { return true; }\n                    ev.preventDefault();\n                    that.resizing.chatbox.resizeChatBox(ev);\n                });\n\n                $(document).on('mouseup', function (ev) {\n                    if (!that.resizing || !that.allow_dragresize) { return true; }\n                    ev.preventDefault();\n                    const height = that.applyDragResistance(\n                            that.resizing.chatbox.height,\n                            that.resizing.chatbox.model.get('default_height')\n                    );\n                    const width = that.applyDragResistance(\n                            that.resizing.chatbox.width,\n                            that.resizing.chatbox.model.get('default_width')\n                    );\n                    if (that.connection.connected) {\n                        that.resizing.chatbox.model.save({'height': height});\n                        that.resizing.chatbox.model.save({'width': width});\n                    } else {\n                        that.resizing.chatbox.model.set({'height': height});\n                        that.resizing.chatbox.model.set({'width': width});\n                    }\n                    that.resizing = null;\n                });\n\n                return this.__super__.registerGlobalEventHandlers.apply(this, arguments);\n            },\n\n            ChatBox: {\n                initialize () {\n                    const { _converse } = this.__super__;\n                    const result = this.__super__.initialize.apply(this, arguments),\n                        height = this.get('height'), width = this.get('width'),\n                        save = this.get('id') === 'controlbox' ? this.set.bind(this) : this.save.bind(this);\n                    save({\n                        'height': _converse.applyDragResistance(height, this.get('default_height')),\n                        'width': _converse.applyDragResistance(width, this.get('default_width')),\n                    });\n                    return result;\n                }\n            },\n\n            ChatBoxView: {\n                events: {\n                    'mousedown .dragresize-top': 'onStartVerticalResize',\n                    'mousedown .dragresize-left': 'onStartHorizontalResize',\n                    'mousedown .dragresize-topleft': 'onStartDiagonalResize'\n                },\n\n                initialize () {\n                    $(window).on('resize', _.debounce(this.setDimensions.bind(this), 100));\n                    this.__super__.initialize.apply(this, arguments);\n                },\n\n                render () {\n                    const result = this.__super__.render.apply(this, arguments);\n                    renderDragResizeHandles(this.__super__._converse, this);\n                    this.setWidth();\n                    return result;\n                },\n\n                setWidth () {\n                    // If a custom width is applied (due to drag-resizing),\n                    // then we need to set the width of the .chatbox element as well.\n                    if (this.model.get('width')) {\n                        this.$el.css('width', this.model.get('width'));\n                    }\n                },\n\n                _show () {\n                    this.initDragResize().setDimensions();\n                    this.__super__._show.apply(this, arguments);\n                },\n\n                initDragResize () {\n                    /* Determine and store the default box size.\n                     * We need this information for the drag-resizing feature.\n                     */\n                    const { _converse } = this.__super__;\n                    const $flyout = this.$el.find('.box-flyout');\n                    if (_.isUndefined(this.model.get('height'))) {\n                        const height = $flyout.height();\n                        const width = $flyout.width();\n                        this.model.set('height', height);\n                        this.model.set('default_height', height);\n                        this.model.set('width', width);\n                        this.model.set('default_width', width);\n                    }\n                    const min_width = $flyout.css('min-width');\n                    const min_height = $flyout.css('min-height');\n                    this.model.set('min_width', min_width.endsWith('px') ? Number(min_width.replace(/px$/, '')) :0);\n                    this.model.set('min_height', min_height.endsWith('px') ? Number(min_height.replace(/px$/, '')) :0);\n                    // Initialize last known mouse position\n                    this.prev_pageY = 0;\n                    this.prev_pageX = 0;\n                    if (_converse.connection.connected) {\n                        this.height = this.model.get('height');\n                        this.width = this.model.get('width');\n                    }\n                    return this;\n                },\n\n                setDimensions () {\n                    // Make sure the chat box has the right height and width.\n                    this.adjustToViewport();\n                    this.setChatBoxHeight(this.model.get('height'));\n                    this.setChatBoxWidth(this.model.get('width'));\n                },\n\n                setChatBoxHeight (height) {\n                    const { _converse } = this.__super__;\n                    if (height) {\n                        height = _converse.applyDragResistance(height, this.model.get('default_height'))+'px';\n                    } else {\n                        height = \"\";\n                    }\n                    this.$el.children('.box-flyout')[0].style.height = height;\n                },\n\n                setChatBoxWidth (width) {\n                    const { _converse } = this.__super__;\n                    if (width) {\n                        width = _converse.applyDragResistance(width, this.model.get('default_width'))+'px';\n                    } else {\n                        width = \"\";\n                    }\n                    this.$el[0].style.width = width;\n                    this.$el.children('.box-flyout')[0].style.width = width;\n                },\n\n\n                adjustToViewport () {\n                    /* Event handler called when viewport gets resized. We remove\n                     * custom width/height from chat boxes.\n                     */\n                    const viewport_width = Math.max(document.documentElement.clientWidth, window.innerWidth || 0);\n                    const viewport_height = Math.max(document.documentElement.clientHeight, window.innerHeight || 0);\n                    if (viewport_width <= 480) {\n                        this.model.set('height', undefined);\n                        this.model.set('width', undefined);\n                    } else if (viewport_width <= this.model.get('width')) {\n                        this.model.set('width', undefined);\n                    } else if (viewport_height <= this.model.get('height')) {\n                        this.model.set('height', undefined);\n                    }\n                },\n\n                onStartVerticalResize (ev) {\n                    const { _converse } = this.__super__;\n                    if (!_converse.allow_dragresize) { return true; }\n                    // Record element attributes for mouseMove().\n                    this.height = this.$el.children('.box-flyout').height();\n                    _converse.resizing = {\n                        'chatbox': this,\n                        'direction': 'top'\n                    };\n                    this.prev_pageY = ev.pageY;\n                },\n\n                onStartHorizontalResize (ev) {\n                    const { _converse } = this.__super__;\n                    if (!_converse.allow_dragresize) { return true; }\n                    this.width = this.$el.children('.box-flyout').width();\n                    _converse.resizing = {\n                        'chatbox': this,\n                        'direction': 'left'\n                    };\n                    this.prev_pageX = ev.pageX;\n                },\n\n                onStartDiagonalResize (ev) {\n                    const { _converse } = this.__super__;\n                    this.onStartHorizontalResize(ev);\n                    this.onStartVerticalResize(ev);\n                    _converse.resizing.direction = 'topleft';\n                },\n\n                resizeChatBox (ev) {\n                    let diff;\n                    const { _converse } = this.__super__;\n                    if (_converse.resizing.direction.indexOf('top') === 0) {\n                        diff = ev.pageY - this.prev_pageY;\n                        if (diff) {\n                            this.height = ((this.height-diff) > (this.model.get('min_height') || 0)) ? (this.height-diff) : this.model.get('min_height');\n                            this.prev_pageY = ev.pageY;\n                            this.setChatBoxHeight(this.height);\n                        }\n                    }\n                    if (_.includes(_converse.resizing.direction, 'left')) {\n                        diff = this.prev_pageX - ev.pageX;\n                        if (diff) {\n                            this.width = ((this.width+diff) > (this.model.get('min_width') || 0)) ? (this.width+diff) : this.model.get('min_width');\n                            this.prev_pageX = ev.pageX;\n                            this.setChatBoxWidth(this.width);\n                        }\n                    }\n                }\n            },\n\n            HeadlinesBoxView: {\n                events: {\n                    'mousedown .dragresize-top': 'onStartVerticalResize',\n                    'mousedown .dragresize-left': 'onStartHorizontalResize',\n                    'mousedown .dragresize-topleft': 'onStartDiagonalResize'\n                },\n\n                initialize () {\n                    $(window).on('resize', _.debounce(this.setDimensions.bind(this), 100));\n                    return this.__super__.initialize.apply(this, arguments);\n                },\n\n                render () {\n                    const result = this.__super__.render.apply(this, arguments);\n                    renderDragResizeHandles(this.__super__._converse, this);\n                    this.setWidth();\n                    return result;\n                }\n            },\n\n            ControlBoxView: {\n                events: {\n                    'mousedown .dragresize-top': 'onStartVerticalResize',\n                    'mousedown .dragresize-left': 'onStartHorizontalResize',\n                    'mousedown .dragresize-topleft': 'onStartDiagonalResize'\n                },\n\n                initialize () {\n                    $(window).on('resize', _.debounce(this.setDimensions.bind(this), 100));\n                    this.__super__.initialize.apply(this, arguments);\n                },\n\n                render () {\n                    const result = this.__super__.render.apply(this, arguments);\n                    renderDragResizeHandles(this.__super__._converse, this);\n                    this.setWidth();\n                    return result;\n                },\n\n                renderLoginPanel () {\n                    const result = this.__super__.renderLoginPanel.apply(this, arguments);\n                    this.initDragResize().setDimensions();\n                    return result;\n                },\n\n                renderContactsPanel () {\n                    const result = this.__super__.renderContactsPanel.apply(this, arguments);\n                    this.initDragResize().setDimensions();\n                    return result;\n                }\n            },\n\n            ChatRoomView: {\n                events: {\n                    'mousedown .dragresize-top': 'onStartVerticalResize',\n                    'mousedown .dragresize-left': 'onStartHorizontalResize',\n                    'mousedown .dragresize-topleft': 'onStartDiagonalResize'\n                },\n\n                initialize () {\n                    $(window).on('resize', _.debounce(this.setDimensions.bind(this), 100));\n                    this.__super__.initialize.apply(this, arguments);\n                },\n\n                render () {\n                    const result = this.__super__.render.apply(this, arguments);\n                    renderDragResizeHandles(this.__super__._converse, this);\n                    this.setWidth();\n                    return result;\n                }\n            }\n        },\n\n        initialize () {\n            /* The initialize function gets called as soon as the plugin is\n             * loaded by converse.js's plugin machinery.\n             */\n            const { _converse } = this;\n\n            _converse.api.settings.update({\n                allow_dragresize: true,\n            });\n\n            _converse.applyDragResistance = function (value, default_value) {\n                /* This method applies some resistance around the\n                * default_value. If value is close enough to\n                * default_value, then default_value is returned instead.\n                */\n                if (_.isUndefined(value)) {\n                    return undefined;\n                } else if (_.isUndefined(default_value)) {\n                    return value;\n                }\n                const resistance = 10;\n                if ((value !== default_value) &&\n                    (Math.abs(value- default_value) < resistance)) {\n                    return default_value;\n                }\n                return value;\n            };\n        }\n    });\n}));\n"]}