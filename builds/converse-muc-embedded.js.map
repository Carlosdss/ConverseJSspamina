{"version":3,"sources":["../src/converse-muc-embedded.js"],"names":["root","factory","define","converse","env","Backbone","_","plugins","add","overrides","ChatBoxes","onConnected","_converse","__super__","browserStorage","BrowserStorage","storage","b64_sha1","bare_jid","registerMessageHandler","onChatBoxesFetched","Collection","ChatRoomView","insertIntoDOM","document","body","contains","el","container","querySelector","innerHTML","appendChild","initialize","isArray","auto_join_rooms","Error","length"],"mappings":";;AAAA;AACA;AACA;AACA;AACA;AACA;AACC,WAAUA,IAAV,EAAgBC,OAAhB,EAAyB;AACtBC,WAAO,CAAC,eAAD,EAAkB,cAAlB,CAAP,EAA0CD,OAA1C;AACH,CAFA,aAEO,UAAUE,QAAV,EAAoB;AACxB;;AADwB,wBAEAA,SAASC,GAFT;AAAA,QAEhBC,QAFgB,iBAEhBA,QAFgB;AAAA,QAENC,CAFM,iBAENA,CAFM;;;AAIxBH,aAASI,OAAT,CAAiBC,GAAjB,CAAqB,uBAArB,EAA8C;AAC1CC,mBAAW;AACP;AACA;AACA;AACA;AACA;;AAEAC,uBAAW;AACPC,2BADO,yBACQ;AACX;AACA;AAFW,wBAGHC,SAHG,GAGW,KAAKC,SAHhB,CAGHD,SAHG;;AAIX,yBAAKE,cAAL,GAAsB,IAAIT,SAASU,cAAT,CAAwBH,UAAUI,OAAlC,CAAJ,CAClBb,SAASC,GAAT,CAAaa,QAAb,yBAA4CL,UAAUM,QAAtD,CADkB,CAAtB;AAEA,yBAAKC,sBAAL;AACA;;;;;;;AAOC,yBAAKC,kBAAL,CAAwB,IAAIf,SAASgB,UAAb,EAAxB;AACJ;AAhBM,aAPJ;;AA0BPC,0BAAc;AACVC,6BADU,2BACO;AACb,wBAAI,CAACC,SAASC,IAAT,CAAcC,QAAd,CAAuB,KAAKC,EAA5B,CAAL,EAAsC;AAClC,4BAAMC,YAAYJ,SAASK,aAAT,CAAuB,yBAAvB,CAAlB;AACAD,kCAAUE,SAAV,GAAsB,EAAtB;AACAF,kCAAUG,WAAV,CAAsB,KAAKJ,EAA3B;AACH;AACD,2BAAO,IAAP;AACH;AARS;AA1BP,SAD+B;;AAuC1CK,kBAvC0C,wBAuC5B;AACV;;;AADU,gBAIFpB,SAJE,GAIY,IAJZ,CAIFA,SAJE;;AAKV,gBAAI,CAACN,EAAE2B,OAAF,CAAUrB,UAAUsB,eAApB,CAAL,EAA2C;AACvC,sBAAM,IAAIC,KAAJ,CAAU,yDAAV,CAAN;AACH;AACD,gBAAIvB,UAAUsB,eAAV,CAA0BE,MAA1B,KAAqC,CAAzC,EAA4C;AACxC,sBAAM,IAAID,KAAJ,CAAU,4CACZ,uDADY,GAEZ,sDAFY,GAGZ,cAHE,CAAN;AAIH;AACJ;AArDyC,KAA9C;AAuDH,CA7DA,CAAD","file":"converse-muc-embedded.js","sourcesContent":["// Converse.js (A browser based XMPP chat client)\n// http://conversejs.org\n//\n// Copyright (c) 2012-2017, Jan-Carel Brand <jc@opkode.com>\n// Licensed under the Mozilla Public License (MPLv2)\n//\n(function (root, factory) {\n    define([\"converse-core\", \"converse-muc\"], factory);\n}(this, function (converse) {\n    \"use strict\";\n    const { Backbone, _ } = converse.env;\n\n    converse.plugins.add('converse-muc-embedded', {\n        overrides: {\n            // Overrides mentioned here will be picked up by converse.js's\n            // plugin architecture they will replace existing methods on the\n            // relevant objects or classes.\n            //\n            // New functions which don't exist yet can also be added.\n\n            ChatBoxes: {\n                onConnected () {\n                    // Override to avoid storing or fetching chat boxes from session\n                    // storage.\n                    const { _converse } = this.__super__;\n                    this.browserStorage = new Backbone.BrowserStorage[_converse.storage](\n                        converse.env.b64_sha1(`converse.chatboxes-${_converse.bare_jid}`));\n                    this.registerMessageHandler();\n                    /* This is disabled:\n                     *\n                     * this.fetch({\n                     *      add: true,\n                     *      success: this.onChatBoxesFetched.bind(this)\n                     *  });\n                     */\n                     this.onChatBoxesFetched(new Backbone.Collection());\n                }\n            },\n\n            ChatRoomView: {\n                insertIntoDOM () {\n                    if (!document.body.contains(this.el)) {\n                        const container = document.querySelector('#converse-embedded-chat');\n                        container.innerHTML = '';\n                        container.appendChild(this.el);\n                    }\n                    return this;\n                }\n            }\n        },\n\n        initialize () {\n            /* The initialize function gets called as soon as the plugin is\n             * loaded by converse.js's plugin machinery.\n             */\n            const { _converse } = this;\n            if (!_.isArray(_converse.auto_join_rooms)) {\n                throw new Error(\"converse-muc-embedded: auto_join_rooms must be an Array\");\n            }\n            if (_converse.auto_join_rooms.length !== 1) {\n                throw new Error(\"converse-muc-embedded: It doesn't make \"+\n                    \"sense to have the auto_join_rooms setting to zero or \"+\n                    \"more then one, since only one chat room can be open \"+\n                    \"at any time.\");\n            }\n        }\n    });\n}));\n"]}